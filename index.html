<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Rutina Mancuernas (PUSH / PULL / LEGS + UPPER) ‚Äî Jorge</title>
  <style>
    :root{
      --bg:#0b1020; --card:#111a33; --muted:#93a4c7; --text:#eaf0ff;
      --accent:#6ee7ff; --accent2:#a78bfa; --ok:#34d399; --warn:#fbbf24; --bad:#fb7185;
      --border:rgba(255,255,255,.10);
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius:16px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    [data-theme="light"]{
      --bg:#f6f8ff; --card:#ffffff; --muted:#4b5a7a; --text:#0b1020;
      --accent:#0077ff; --accent2:#7c3aed; --border:rgba(11,16,32,.12);
      --shadow: 0 10px 30px rgba(11,16,32,.12);
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:var(--sans); background: radial-gradient(1200px 600px at 20% 0%, rgba(110,231,255,.18), transparent 60%),
      radial-gradient(900px 500px at 90% 10%, rgba(167,139,250,.18), transparent 60%),
      var(--bg);
      color:var(--text);
    }
    .wrap{max-width:1100px; margin:0 auto; padding:20px 16px 40px}
    header{
      display:flex; gap:12px; align-items:flex-start; justify-content:space-between; flex-wrap:wrap;
      margin-bottom:14px;
    }
    .title{
      display:flex; flex-direction:column; gap:6px;
    }
    h1{margin:0; font-size:22px; letter-spacing:.2px}
    .sub{color:var(--muted); font-size:13px; line-height:1.35}
    .pillrow{display:flex; gap:8px; flex-wrap:wrap; align-items:center}
    .pill{
      border:1px solid var(--border); background:rgba(255,255,255,.04); color:var(--text);
      padding:8px 10px; border-radius:999px; font-size:12px;
      display:inline-flex; gap:8px; align-items:center;
    }
    [data-theme="light"] .pill{background:rgba(11,16,32,.03)}
    .pill b{font-family:var(--mono); font-weight:700; letter-spacing:.2px}
    .btn{
      border:1px solid var(--border); background:linear-gradient(180deg, rgba(110,231,255,.18), rgba(167,139,250,.10));
      color:var(--text); padding:10px 12px; border-radius:12px; cursor:pointer;
      font-weight:700; font-size:13px;
      box-shadow:var(--shadow);
      user-select:none;
    }
    .btn.secondary{background:transparent; box-shadow:none}
    .btn:active{transform:translateY(1px)}
    .row{display:grid; grid-template-columns: 1.2fr .8fr; gap:12px; margin-top:12px}
    @media (max-width: 920px){ .row{grid-template-columns:1fr} }
    .card{
      background:var(--card); border:1px solid var(--border); border-radius:var(--radius);
      box-shadow:var(--shadow); overflow:hidden;
    }
    .card .hd{
      padding:14px 14px 10px; border-bottom:1px solid var(--border);
      display:flex; justify-content:space-between; gap:10px; align-items:center; flex-wrap:wrap;
    }
    .card .hd h2{margin:0; font-size:15px}
    .card .bd{padding:12px 14px 14px}
    .tabs{display:flex; gap:8px; flex-wrap:wrap}
    .tab{
      border:1px solid var(--border); background:transparent; color:var(--text);
      padding:10px 12px; border-radius:12px; cursor:pointer; font-weight:800; font-size:13px;
    }
    .tab.active{background:linear-gradient(180deg, rgba(110,231,255,.22), rgba(167,139,250,.14))}
    .grid2{display:grid; grid-template-columns:1fr 1fr; gap:10px}
    @media (max-width: 720px){ .grid2{grid-template-columns:1fr} }
    .meta{
      color:var(--muted); font-size:12px; display:flex; gap:10px; flex-wrap:wrap; align-items:center
    }
    .meta .k{padding:6px 8px; border:1px solid var(--border); border-radius:999px}
    table{width:100%; border-collapse:separate; border-spacing:0; overflow:hidden}
    th,td{padding:10px 8px; text-align:left; border-bottom:1px solid var(--border); vertical-align:top}
    th{font-size:12px; color:var(--muted); font-weight:800}
    td{font-size:13px}
    .exname{font-weight:900}
    .links{display:flex; gap:8px; flex-wrap:wrap; margin-top:6px}
    a.link{
      text-decoration:none; color:var(--text);
      border:1px solid var(--border); padding:6px 8px; border-radius:10px; font-size:12px;
      background:rgba(255,255,255,.04);
    }
    [data-theme="light"] a.link{background:rgba(11,16,32,.03)}
    .hint{color:var(--muted); font-size:12px; margin-top:6px; line-height:1.35}
    .chk{
      display:flex; align-items:center; gap:8px;
      font-size:12px; color:var(--muted);
    }
    input[type="checkbox"]{transform:scale(1.1)}
    .in{
      width:92px; padding:8px 8px; border-radius:10px; border:1px solid var(--border);
      background:transparent; color:var(--text); font-family:var(--mono); font-size:12px;
    }
    .in.small{width:72px}
    .in.long{width:140px}
    .stack{display:flex; gap:8px; flex-wrap:wrap; align-items:center}
    .badge{
      display:inline-flex; gap:8px; align-items:center; padding:6px 10px; border-radius:999px;
      border:1px solid var(--border); font-size:12px; color:var(--muted);
    }
    .badge strong{color:var(--text)}
    .timerBox{
      display:flex; gap:10px; align-items:center; flex-wrap:wrap;
      padding:12px; border-radius:14px; border:1px solid var(--border); background:rgba(255,255,255,.04);
    }
    [data-theme="light"] .timerBox{background:rgba(11,16,32,.03)}
    .clock{
      font-family:var(--mono); font-size:26px; font-weight:900; letter-spacing:1px;
    }
    .note{
      width:100%; min-height:92px; resize:vertical;
      padding:10px; border-radius:12px; border:1px solid var(--border);
      background:transparent; color:var(--text);
      font-family:var(--sans); font-size:13px;
    }
    .footer{
      margin-top:14px; color:var(--muted); font-size:12px; line-height:1.45
    }
    .ok{color:var(--ok)} .warn{color:var(--warn)} .bad{color:var(--bad)}
    .split{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .right{margin-left:auto}
  </style>
</head>
<body>
  <div class="wrap" id="app">
    <header>
      <div class="title">
        <h1>Rutina Mancuernas (4 d√≠as) ‚Äî PUSH / PULL / LEGS + UPPER</h1>
        <div class="sub">
          Dise√±ada para: <b>87 kg</b>, 39‚Äì40 a√±os, <b>ganancia limpia</b> y entreno nocturno (8‚Äì9 pm).<br/>
          Reglas: 60‚Äì75 min ‚Ä¢ descanso 60‚Äì90 s ‚Ä¢ 1‚Äì2 reps en reserva (RIR) en la mayor√≠a de series ‚Ä¢ progresi√≥n semanal.
        </div>
        <div class="pillrow">
          <span class="pill">Post-entreno: <b>160 g gainer</b> + <b>300 g leche</b> (+ agua si lo quieres m√°s ligero)</span>
          <span class="pill">Objetivo: <b>+0.3‚Äì0.6 kg/sem</b> y cintura controlada</span>
          <span class="pill">Progresi√≥n: <b>+1 rep</b> o <b>+1‚Äì2 kg</b> por semana</span>
        </div>
      </div>
      <div class="pillrow">
        <button class="btn secondary" id="themeBtn" title="Cambiar tema">üåó Tema</button>
        <button class="btn secondary" id="resetBtn" title="Borrar checks y registros del d√≠a actual">üßπ Reset d√≠a</button>
        <button class="btn" id="exportBtn" title="Exportar tu registro a CSV">‚¨áÔ∏è Exportar CSV</button>
      </div>
    </header>

    <div class="row">
      <section class="card">
        <div class="hd">
          <div class="split" style="width:100%">
            <h2>Selecciona el d√≠a</h2>
            <div class="tabs right" id="tabs"></div>
          </div>
          <div class="meta" id="dayMeta"></div>
        </div>
        <div class="bd">
          <div class="grid2" style="margin-bottom:12px">
            <div class="timerBox">
              <div>
                <div class="badge"><strong>Timer descanso</strong> (60‚Äì90 s recomendado)</div>
                <div class="clock" id="clock">01:15</div>
              </div>
              <div class="stack">
                <button class="btn secondary" id="t60">60s</button>
                <button class="btn secondary" id="t75">75s</button>
                <button class="btn secondary" id="t90">90s</button>
                <button class="btn" id="startStop">‚ñ∂Ô∏é Iniciar</button>
                <button class="btn secondary" id="resetTimer">‚Ü∫ Reset</button>
              </div>
              <div class="hint">Tip: descansa 60‚Äì75s en accesorios (elevaciones, curls) y 75‚Äì90s en compuestos (press, row, squat).</div>
            </div>
            <div class="timerBox">
              <div class="badge"><strong>Progresi√≥n</strong> (simple y efectiva)</div>
              <div class="hint">
                Si completas el rango alto de reps con buena t√©cnica en todas las series, la pr√≥xima sesi√≥n sube:
                <span class="ok"><b>+1 rep</b></span> o <span class="ok"><b>+1‚Äì2 kg</b></span> por mancuerna.
                Mant√©n <b>1‚Äì2 RIR</b> (no al fallo) salvo la √∫ltima serie de un accesorio.
              </div>
            </div>
          </div>

          <div style="overflow:auto; border-radius:14px; border:1px solid var(--border)">
            <table id="workTable">
              <thead>
                <tr>
                  <th style="min-width:260px">Ejercicio</th>
                  <th>Series √ó Reps</th>
                  <th>Desc.</th>
                  <th style="min-width:200px">Registro (por mancuerna)</th>
                  <th>Hecho</th>
                </tr>
              </thead>
              <tbody id="tbody"></tbody>
            </table>
          </div>

          <div class="footer">
            <div class="badge"><strong>Calentamiento (5‚Äì8 min)</strong> movilidad hombros/cadera + 2 series ligeras del primer ejercicio.</div>
            <div class="badge"><strong>Enfriamiento (3‚Äì5 min)</strong> respiraci√≥n + estiramiento suave (no agresivo).</div>
          </div>
        </div>
      </section>

      <aside class="card">
        <div class="hd">
          <h2>Notas y control</h2>
          <div class="meta">
            <span class="k">‚úÖ Marca ejercicios</span>
            <span class="k">üßæ Guarda peso y reps</span>
            <span class="k">üíæ Se guarda solo</span>
          </div>
        </div>
        <div class="bd">
          <div class="badge"><strong>Chequeo semanal (domingo, en ayunas)</strong></div>
          <ul class="hint" style="margin-top:8px">
            <li><b>Peso:</b> busca +0.3 a +0.6 kg/sem.</li>
            <li><b>Cintura:</b> si sube muy r√°pido, baja el gainer o ajusta carbos.</li>
            <li><b>Sue√±o:</b> prioridad #1 para crecer (sin cafe√≠na ya ganaste).</li>
          </ul>

          <div class="badge" style="margin-top:10px"><strong>Notas del d√≠a</strong> (dolores, energ√≠a, cargas)</div>
          <textarea class="note" id="notes" placeholder="Ej: Press inclinado 18kg x 10/10/9. Me sent√≠ bien. Sin dolor hombro."></textarea>

          <div class="badge" style="margin-top:10px"><strong>Hidrataci√≥n (c√°lculos renales)</strong></div>
          <div class="hint">
            Objetivo diario: <b>2.5‚Äì3 L</b> de agua. Orina amarillo p√°lido. Evita exceso de sal/ultraprocesados.
          </div>

          <div class="badge" style="margin-top:10px"><strong>Tu stack recomendado</strong></div>
          <div class="hint">
            <b>Shroom Tech Sport</b>: 30‚Äì45 min pre-entreno (solo d√≠as de entreno).<br/>
            <b>Alpha Brain</b>: por la ma√±ana con desayuno (no de noche).<br/>
            <b>Gainer</b>: post-entreno (160 g) + 300 g leche (+ agua si lo quieres menos espeso).
          </div>

          <div class="footer">
            Si un ejercicio molesta (dolor articular), c√°mbialo por una variante similar. Dolor muscular normal = ok; dolor punzante/articular = <span class="bad"><b>para</b></span>.
          </div>
        </div>
      </aside>
    </div>
  </div>

<script>
/**
 * Rutina por d√≠as + enlaces + tracker localStorage
 * - No requiere internet salvo para abrir links de t√©cnica
 * - Exporta CSV con el registro (d√≠a, ejercicio, series/reps, peso, reps reales, notas)
 */

const ROUTINE = [
  {
    key:"push",
    name:"D√≠a 1 ‚Äî PUSH",
    focus:"Pecho ‚Ä¢ Hombro ‚Ä¢ Tr√≠ceps",
    target:"60‚Äì75 min",
    exercises:[
      ex("Press de pecho con mancuernas (en banco o piso)","4√ó8‚Äì10","75‚Äì90s","chest","dumbbells","dumbbell bench press"),
      ex("Press inclinado con mancuernas (o piso con elevaci√≥n)","3√ó10‚Äì12","75‚Äì90s","chest","dumbbells","incline dumbbell press"),
      ex("Aperturas con mancuernas (fly)","3√ó12","60‚Äì75s","chest","dumbbells","dumbbell fly"),
      ex("Press militar con mancuernas","3√ó8‚Äì10","75‚Äì90s","shoulders","dumbbells","dumbbell shoulder press"),
      ex("Elevaciones laterales","3√ó12‚Äì15","60s","shoulders","dumbbells","dumbbell lateral raise"),
      ex("Extensi√≥n de tr√≠ceps por encima de la cabeza","3√ó10‚Äì12","60‚Äì75s","triceps","dumbbells","overhead dumbbell triceps extension"),
    ]
  },
  {
    key:"pull",
    name:"D√≠a 2 ‚Äî PULL",
    focus:"Espalda ‚Ä¢ B√≠ceps",
    target:"60‚Äì75 min",
    exercises:[
      ex("Remo a una mano con mancuerna","4√ó8‚Äì10 c/lado","75‚Äì90s","back","dumbbells","one arm dumbbell row"),
      ex("Pullover con mancuerna","3√ó10‚Äì12","75s","back","dumbbells","dumbbell pullover"),
      ex("P√°jaros / Rear delt fly (deltoide posterior)","3√ó12‚Äì15","60‚Äì75s","shoulders","dumbbells","rear delt fly dumbbell"),
      ex("Curl de b√≠ceps con mancuernas","3√ó10‚Äì12","60‚Äì75s","biceps","dumbbells","dumbbell biceps curl"),
      ex("Curl martillo (hammer curl)","3√ó10‚Äì12","60‚Äì75s","biceps","dumbbells","hammer curl dumbbell"),
    ]
  },
  {
    key:"legs",
    name:"D√≠a 3 ‚Äî LEGS + CORE",
    focus:"Piernas ‚Ä¢ Gl√∫teos ‚Ä¢ Core",
    target:"60‚Äì70 min",
    exercises:[
      ex("Sentadilla goblet","4√ó10‚Äì12","75‚Äì90s","quads","dumbbells","goblet squat"),
      ex("Peso muerto rumano con mancuernas","4√ó8‚Äì10","75‚Äì90s","hamstrings","dumbbells","dumbbell romanian deadlift"),
      ex("Zancadas (lunges)","3√ó10 c/pierna","75s","glutes","dumbbells","dumbbell lunge"),
      ex("Elevaci√≥n de pantorrillas de pie","4√ó15‚Äì20","60s","calves","dumbbells","standing calf raise dumbbell"),
      ex("Plancha (plank)","3√ó30‚Äì45s","45‚Äì60s","abs","bodyweight","plank"),
      ex("Crunch o elevaci√≥n de piernas","3√ó12‚Äì15","45‚Äì60s","abs","bodyweight","leg raises"),
    ]
  },
  {
    key:"upper",
    name:"D√≠a 4 ‚Äî FULL UPPER (calidad)",
    focus:"Torso completo ‚Ä¢ T√©cnica ‚Ä¢ Bombeo",
    target:"50‚Äì60 min",
    exercises:[
      ex("Press de pecho con mancuernas (moderado)","3√ó10","75s","chest","dumbbells","dumbbell bench press"),
      ex("Remo a una mano (moderado)","3√ó10 c/lado","75s","back","dumbbells","one arm dumbbell row"),
      ex("Press militar (moderado)","3√ó10","75s","shoulders","dumbbells","dumbbell shoulder press"),
      ex("Superset: Curl + Extensi√≥n tr√≠ceps","3√ó12 cada uno","60s","arms","dumbbells","dumbbell curl superset triceps extension"),
    ]
  }
];

function ex(name, setsReps, rest, muscle, equipment, query){
  return { name, setsReps, rest, muscle, equipment, query };
}

const $ = (s)=>document.querySelector(s);
const $$ = (s)=>Array.from(document.querySelectorAll(s));
const LS_KEY = "jj_rutina_mancuernas_v1";
const todayKey = ()=> new Date().toISOString().slice(0,10); // YYYY-MM-DD
const state = loadState();

let currentDay = ROUTINE[0].key;
renderTabs();
setDay(currentDay);
wireTimer();
wireTopActions();
wireNotes();

function renderTabs(){
  const tabs = $("#tabs");
  tabs.innerHTML = "";
  for(const d of ROUTINE){
    const b = document.createElement("button");
    b.className = "tab";
    b.textContent = d.name;
    b.onclick = ()=> setDay(d.key);
    b.dataset.key = d.key;
    tabs.appendChild(b);
  }
}
function setDay(key){
  currentDay = key;
  $$("#tabs .tab").forEach(t=>t.classList.toggle("active", t.dataset.key===key));
  const day = ROUTINE.find(d=>d.key===key);
  $("#dayMeta").innerHTML = `
    <span class="k">Enfoque: <b>${day.focus}</b></span>
    <span class="k">Duraci√≥n: <b>${day.target}</b></span>
    <span class="k">Objetivo: <b>1‚Äì2 RIR</b> (sin fallo)</span>
  `;
  renderTable(day);
  $("#notes").value = (state.notes?.[todayKey()]?.[currentDay]) || "";
}

function mkMuscleWikiUrl(muscle, equipment){
  // MuscleWiki usa paths /es-es/exercises/<muscle>/<equipment>
  const m = encodeURIComponent(muscle);
  const e = encodeURIComponent(equipment);
  return `https://musclewiki.com/es-es/exercises/${m}/${e}`;
}
function mkYouTubeSearchUrl(q){
  return `https://www.youtube.com/results?search_query=${encodeURIComponent(q)}`;
}

function renderTable(day){
  const tbody = $("#tbody");
  tbody.innerHTML = "";
  const dayState = getDayState();

  day.exercises.forEach((x, idx)=>{
    const id = `${todayKey()}::${currentDay}::${idx}`;
    const saved = dayState.rows?.[idx] || {};
    const tr = document.createElement("tr");

    const muscleWiki = mkMuscleWikiUrl(x.muscle, x.equipment);
    const yt = mkYouTubeSearchUrl(`${x.query} t√©cnica correcta espa√±ol mancuernas`);
    const form = `
      <div class="exname">${x.name}</div>
      <div class="links">
        <a class="link" href="${muscleWiki}" target="_blank" rel="noopener">üìö MuscleWiki</a>
        <a class="link" href="${yt}" target="_blank" rel="noopener">‚ñ∂Ô∏é YouTube (buscar)</a>
      </div>
      <div class="hint">Tip: movimiento controlado (2s bajar / 1s subir). Si duele articulaci√≥n, reduce rango o cambia variante.</div>
    `;

    tr.innerHTML = `
      <td>${form}</td>
      <td><span class="badge"><strong>${x.setsReps}</strong></span></td>
      <td><span class="badge">${x.rest}</span></td>
      <td>
        <div class="stack">
          <label class="badge">Peso (kg)
            <input class="in small" inputmode="decimal" placeholder="0" value="${esc(saved.weight||"")}" data-field="weight" data-idx="${idx}">
          </label>
          <label class="badge">Reps reales
            <input class="in small" inputmode="numeric" placeholder="0" value="${esc(saved.reps||"")}" data-field="reps" data-idx="${idx}">
          </label>
          <label class="badge">Notas
            <input class="in long" placeholder="ej: 10/10/9" value="${esc(saved.note||"")}" data-field="note" data-idx="${idx}">
          </label>
        </div>
      </td>
      <td>
        <label class="chk">
          <input type="checkbox" ${saved.done ? "checked":""} data-field="done" data-idx="${idx}">
          Hecho
        </label>
      </td>
    `;
    tbody.appendChild(tr);
  });

  tbody.querySelectorAll("input").forEach(inp=>{
    inp.addEventListener("input", ()=>{
      const idx = Number(inp.dataset.idx);
      const field = inp.dataset.field;
      const v = (field==="done") ? inp.checked : inp.value;
      updateRow(idx, field, v);
    });
    inp.addEventListener("change", ()=>{
      const idx = Number(inp.dataset.idx);
      const field = inp.dataset.field;
      const v = (field==="done") ? inp.checked : inp.value;
      updateRow(idx, field, v);
    });
  });

  tbody.querySelectorAll("input[type=checkbox]").forEach(chk=>{
    chk.addEventListener("change", ()=>{
      const idx = Number(chk.dataset.idx);
      updateRow(idx, "done", chk.checked);
    });
  });
}

function esc(s){
  return String(s ?? "").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;");
}

function loadState(){
  try{ return JSON.parse(localStorage.getItem(LS_KEY) || "{}"); }catch{ return {}; }
}
function saveState(){
  localStorage.setItem(LS_KEY, JSON.stringify(state));
}
function getDayState(){
  const d = todayKey();
  state.days ??= {};
  state.days[d] ??= {};
  state.days[d][currentDay] ??= { rows:{} };
  return state.days[d][currentDay];
}
function updateRow(idx, field, value){
  const ds = getDayState();
  ds.rows ??= {};
  ds.rows[idx] ??= {};
  ds.rows[idx][field] = value;
  saveState();
}

function wireNotes(){
  $("#notes").addEventListener("input", (e)=>{
    const d = todayKey();
    state.notes ??= {};
    state.notes[d] ??= {};
    state.notes[d][currentDay] = e.target.value;
    saveState();
  });
}

function wireTopActions(){
  // theme
  const themeBtn = $("#themeBtn");
  const applyTheme = (t)=>{
    document.documentElement.setAttribute("data-theme", t);
    state.theme = t;
    saveState();
  };
  applyTheme(state.theme || "dark");
  themeBtn.onclick = ()=>{
    const cur = document.documentElement.getAttribute("data-theme") || "dark";
    applyTheme(cur==="dark" ? "light" : "dark");
  };

  // reset day
  $("#resetBtn").onclick = ()=>{
    const d = todayKey();
    if(state.days?.[d]?.[currentDay]){
      delete state.days[d][currentDay];
    }
    if(state.notes?.[d]?.[currentDay]){
      delete state.notes[d][currentDay];
    }
    saveState();
    setDay(currentDay);
  };

  // export CSV
  $("#exportBtn").onclick = exportCSV;
}

function exportCSV(){
  const d = todayKey();
  const rows = [];
  rows.push(["fecha","dia","ejercicio","series_reps","descanso","peso_kg","reps_reales","nota","hecho","notas_del_dia"].join(","));
  for(const day of ROUTINE){
    const dayKey = day.key;
    const ds = state.days?.[d]?.[dayKey];
    const dayNote = state.notes?.[d]?.[dayKey] || "";
    if(!ds) continue;
    day.exercises.forEach((x, idx)=>{
      const r = ds.rows?.[idx] || {};
      rows.push([
        q(d),
        q(day.name),
        q(x.name),
        q(x.setsReps),
        q(x.rest),
        q(r.weight||""),
        q(r.reps||""),
        q(r.note||""),
        q(r.done ? "1":"0"),
        q(dayNote)
      ].join(","));
    });
  }
  const blob = new Blob([rows.join("\n")], {type:"text/csv;charset=utf-8"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = `rutina_mancuernas_${d}.csv`;
  document.body.appendChild(a);
  a.click();
  setTimeout(()=>{ URL.revokeObjectURL(url); a.remove(); }, 300);
}
function q(v){
  const s = String(v ?? "");
  // escape quotes
  return `"${s.replaceAll('"','""')}"`;
}

// Timer
let timer = { total:75, left:75, running:false, t:null };
function wireTimer(){
  $("#t60").onclick=()=>setTimer(60);
  $("#t75").onclick=()=>setTimer(75);
  $("#t90").onclick=()=>setTimer(90);
  $("#resetTimer").onclick=()=>{ timer.left = timer.total; paintClock(); };
  $("#startStop").onclick=toggleTimer;
  setTimer(75);
}
function setTimer(sec){
  timer.total = sec;
  timer.left = sec;
  paintClock();
}
function paintClock(){
  const mm = String(Math.floor(timer.left/60)).padStart(2,"0");
  const ss = String(timer.left%60).padStart(2,"0");
  $("#clock").textContent = `${mm}:${ss}`;
}
function toggleTimer(){
  if(timer.running){
    timer.running=false;
    clearInterval(timer.t);
    $("#startStop").textContent = "‚ñ∂Ô∏é Iniciar";
    return;
  }
  timer.running=true;
  $("#startStop").textContent = "‚è∏ Pausa";
  timer.t = setInterval(()=>{
    timer.left--;
    if(timer.left<=0){
      timer.left=0;
      paintClock();
      clearInterval(timer.t);
      timer.running=false;
      $("#startStop").textContent = "‚ñ∂Ô∏é Iniciar";
      try{ navigator.vibrate?.(200); }catch(e){}
      // tiny beep
      try{
        const ctx = new (window.AudioContext||window.webkitAudioContext)();
        const o = ctx.createOscillator(); const g = ctx.createGain();
        o.type="sine"; o.frequency.value=880; g.gain.value=0.07;
        o.connect(g); g.connect(ctx.destination); o.start();
        setTimeout(()=>{o.stop(); ctx.close();}, 180);
      }catch(e){}
      return;
    }
    paintClock();
  }, 1000);
}
</script>
</body>
</html>
